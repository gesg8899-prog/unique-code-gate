<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player Gate â€“ Auto Sync</title>
<style>
body{font-family:sans-serif;background:#000;color:#ffd700;text-align:center;padding:60px;}
.gate{max-width:450px;margin:auto;padding:30px;border-radius:20px;background:linear-gradient(145deg,#1a1a1a,#000);border:2px solid #ffd700;box-shadow:0 0 25px #ffcc00;}
input{width:80%;padding:12px;margin-bottom:15px;border-radius:10px;border:1px solid #ffd700;background:#0d0d0d;color:#ffd700;font-size:16px;}
button{padding:12px 20px;border-radius:10px;border:none;background:#ffd700;color:#000;font-weight:bold;cursor:pointer;}
button:hover{background:#ffea66;}
.error{color:#ff4040;margin-top:10px;}
.success{color:#66ff66;margin-top:10px;}
</style>
</head>
<body>
<div class="gate">
<h1>Enter Access Code</h1>
<input type="text" id="codeInput" placeholder="Enter your code">
<input type="text" id="accessToken" placeholder="Admin Token (scope: repo)">
<button onclick="validateCode()">Enter</button>
<p id="msg"></p>
</div>

<script>
// ================================
// CONFIG
// ================================
const username="gesg8899-prog";
const repo="unique-code-gate";
const filePath="player_codes.json";
const redirectURL="https://is.gd/plinko88";

async function fetchCodes(token){
    const res=await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${filePath}?ts=${Date.now()}`,{
        headers:{ "Authorization": `Bearer ${token}` }
    });
    if(res.status===200){
        const data=await res.json();
        const json=atob(data.content);
        return {codes: JSON.parse(json), sha: data.sha};
    } else {
        throw new Error("Failed to fetch codes. Status: "+res.status);
    }
}

async function saveCodes(token,codes,sha){
    const content=btoa(JSON.stringify(codes,null,2));
    const res=await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${filePath}`,{
        method:"PUT",
        headers:{
            "Content-Type":"application/json",
            "Authorization":`Bearer ${token}`
        },
        body:JSON.stringify({message:"Update code usage",content:content,sha:sha})
    });
    return res.ok;
}

// ================================
// VALIDATE CODE
// ================================
async function validateCode(){
    const msg=document.getElementById("msg");
    msg.textContent="";
    const codeInput=document.getElementById("codeInput").value.trim().toUpperCase();
    const token=document.getElementById("accessToken").value.trim();
    if(!codeInput){ msg.textContent="Code cannot be empty"; msg.className="error"; return; }
    if(!token){ msg.textContent="Token required"; msg.className="error"; return; }

    try{
        msg.textContent="Fetching codes..."; msg.className="";
        const {codes, sha}=await fetchCodes(token);
        const entry=codes.find(c=>c.code===codeInput);
        if(!entry){ msg.textContent="Code not found"; msg.className="error"; return; }
        if(entry.used){ msg.textContent="Code already used"; msg.className="error"; return; }

        entry.used=true;
        msg.textContent="Updating server..."; msg.className="success";
        const ok=await saveCodes(token,codes,sha);
        if(!ok){ msg.textContent="Failed to update server"; msg.className="error"; return; }

        msg.textContent="Access granted! Redirecting..."; msg.className="success";
        setTimeout(()=>{ window.location.href=redirectURL; },800);
    } catch(e){
        console.error(e);
        msg.textContent="Connection error or invalid token"; msg.className="error";
    }
}
</script>
</body>
</html>
