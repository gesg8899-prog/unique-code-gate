<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Galactic Plinko</title>
<style>
body{margin:0;background:#010114;display:flex;justify-content:center;align-items:center;height:100vh;font-family:Arial;color:#fff;position:relative;}
.wrap{width:360px;padding:12px;position:relative;display:none;}
canvas{width:100%;height:auto;border-radius:14px;display:block;box-shadow:0 12px 30px rgba(0,0,0,.6);}
header{text-align:center;color:#ff77ff;margin-bottom:8px;font-size:20px;text-shadow:0 0 10px #ff77ff,0 0 20px #ff44ff;}
#pointsGrid{display:flex;justify-content:space-around;margin:12px 0 4px 0;}
.pointBox{width:48px;height:48px;background:rgba(255,255,255,0.05);border:2px solid #0ff;border-radius:8px;display:flex;justify-content:center;align-items:center;font-weight:bold;font-size:16px;color:#0ff;}
#pointsBar{margin:6px 0;background:rgba(0,0,0,0.3);border-radius:8px;height:24px;width:100%;display:flex;overflow:hidden;position:relative;}
#pointsFill{height:100%;width:0%;transition:width 0.4s ease;border-radius:6px;box-shadow:0 0 10px #fff inset;}
#pointsText{position:absolute;left:50%;top:0;transform:translateX(-50%);color:#fff;font-weight:700;text-shadow:0 0 6px #fff;}
#results{margin-top:8px;padding:8px;border-radius:8px;text-align:center;font-size:16px;color:#0ff;text-shadow:0 0 10px #0ff,0 0 20px #0ff;background:rgba(0,0,0,0.2);}
#targets{margin-top:4px;padding:4px;border-radius:8px;text-align:center;font-size:14px;color:#ff9;text-shadow:0 0 6px #ff9,0 0 12px #ff9;}
.floatingPoint{position:absolute;font-weight:bold;font-size:20px;color:#ff0;text-shadow:0 0 8px #ff0,0 0 16px #fff;pointer-events:none;animation:floatUp 1s ease-out forwards;}
@keyframes floatUp{0%{opacity:1;transform:translateY(0);}100%{opacity:0;transform:translateY(-50px);} }
#winPopup,#losePopup{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:flex;justify-content:center;align-items:center;z-index:10;display:none;flex-direction:column;}
#winPopup.active,#losePopup.active{display:flex;}
.popupContent{background:linear-gradient(180deg,#0ff,#44f);padding:20px 28px;border-radius:14px;text-align:center;box-shadow:0 8px 20px rgba(0,0,0,0.7);}
.popupContent h2{color:#ff0;margin-bottom:12px;text-shadow:0 0 10px #ff0,0 0 20px #fff;}
.popupContent p{color:#fff;margin-bottom:12px;}
.popupContent button{margin-top:12px;background:linear-gradient(90deg,#ff9f1c,#ffbf69);color:#022;cursor:pointer;padding:8px 16px;border-radius:8px;border:none;font-weight:700;}
.popupContent img{width:120px;margin-bottom:12px;}
.hint{font-size:14px;color:#ff77ff;text-shadow:0 0 6px #ff77ff;}
#musicToggle{position:absolute;top:12px;right:12px;padding:8px 12px;background:#ff0;color:#022;border:none;border-radius:8px;font-weight:bold;cursor:pointer;z-index:20;}

/* Player Gate Popup */
#gatePopup{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.85);display:flex;justify-content:center;align-items:center;flex-direction:column;z-index:20;}
#gatePopupContent{background:#222;padding:20px;border-radius:12px;text-align:center;color:#fff;}
#gatePopup input{padding:8px;margin-top:10px;border-radius:6px;border:none;width:180px;text-align:center;}
#gatePopup button{margin-top:10px;padding:8px 16px;border-radius:6px;cursor:pointer;font-weight:bold;}
</style>
</head>
<body>

<!-- Player Gate -->
<div id="gatePopup">
  <div id="gatePopupContent">
    <h2>Enter Player Code</h2>
    <input type="text" id="playerCodeInput" placeholder="Enter code"/>
    <button id="submitCodeBtn">Submit</button>
    <p id="gateMessage" style="color:#ff6666;margin-top:8px;"></p>
  </div>
</div>

<div class="wrap">
<header>
<h2>Galactic Plinko</h2>
<div class="hint">Click top area to drop a Ball. Maximum 50 Balls.</div>
</header>

<canvas id="c" width="360" height="640"></canvas>

<div id="pointsGrid"></div>
<div id="pointsBar"><div id="pointsFill"></div><div id="pointsText">0%</div></div>
<div id="results">Total Points: 0 | Balls Left: 50</div>
<div id="targets">Target $3: 58 points | Target $6: 63 points</div>
</div>

<!-- Music toggle button -->
<button id="musicToggle">Mute</button>

<!-- Background Music -->
<audio id="bgMusic" src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" loop></audio>

<!-- Win Popup -->
<div id="winPopup">
<div class="popupContent">
<h2 id="winTitle">ðŸŽ‰ CONGRATULATIONS! ðŸŽ‰</h2>
<p id="winText">Take a screenshot and claim your reward!</p>
<a href="https://t.me/GE88SG_Wallet" target="_blank"><button>Claim Reward</button></a>
</div>
</div>

<!-- Lose Popup -->
<div id="losePopup">
<div class="popupContent">
<img src="https://static.gwvkyk.com/media/b088eca90b196584efa29.png" alt="Try Again"/>
<h2>TRY AGAIN!</h2>
<p>You didnâ€™t reach minimum points. Better luck next time!</p>
<button id="loseCloseBtn">Close</button>
</div>
</div>

<script>
// ===== Player Gate via JSON GitHub =====
const gatePopup = document.getElementById('gatePopup');
const submitCodeBtn = document.getElementById('submitCodeBtn');
const playerCodeInput = document.getElementById('playerCodeInput');
const gateMessage = document.getElementById('gateMessage');
const gameWrap = document.querySelector('.wrap');

let VALID_CODES = [];

// Ganti dengan raw URL JSON GitHub
const JSON_URL = 'https://raw.githubusercontent.com/username/repo/branch/codes.json?t=' + Date.now();

// Ambil kode dari JSON
fetch(JSON_URL)
  .then(res => res.json())
  .then(data => {
    VALID_CODES = data.validCodes || [];
  })
  .catch(err => {
    console.error('Gagal ambil JSON:', err);
    gateMessage.textContent = "Error fetching codes. Try refresh.";
  });

submitCodeBtn.addEventListener('click', () => {
  const code = playerCodeInput.value.trim();
  if(!VALID_CODES.length){
    gateMessage.textContent = "Code list not loaded yet.";
    return;
  }
  if(VALID_CODES.includes(code) && !localStorage.getItem('codeUsed_'+code)){
    localStorage.setItem('codeUsed_'+code,'true');
    gatePopup.style.display = 'none';
    gameWrap.style.display = 'block';
    initGame();
    loop();
  } else {
    gateMessage.textContent = "Code not found or already used!";
  }
});

// ===== Plinko Game Logic =====
// ... disini masukkan semua script Plinko dari versi sebelumnya tanpa diubah
// Untuk ringkas, gunakan script Plinko yang sudah kita buat sebelumnya
// pastikan tetap memanggil initGame() dan loop() setelah kode valid
</script>
</body>
</html>
